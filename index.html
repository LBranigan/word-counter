<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#667eea">
    <title>Word Analyzer</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <header>
            <div class="header-title">
                <h1>Word Analyzer</h1>
                <p class="subtitle">Morningside Academy</p>
            </div>
            <div class="word-count-header">
                <span id="word-count">0</span> words
            </div>
        </header>

        <main>
            <!-- Audio Playback Section (Always visible when active) -->
            <section id="audio-playback-section" class="audio-playback-container">
                <h3>Recorded Audio</h3>
                <audio id="audio-player" controls></audio>
                <div class="audio-actions">
                    <button id="download-audio-btn" class="btn btn-secondary">
                        <span class="icon">üíæ</span> Download Audio
                    </button>
                    <button id="analyze-audio-btn" class="btn btn-primary">
                        <span class="icon">üîç</span> Analyze Audio
                    </button>
                </div>
            </section>

            <!-- API Key Setup Section -->
            <section id="setup-section" class="section active">
                <div class="setup-container">
                    <h2>Setup Required</h2>
                    <p class="setup-description">
                        This app uses Google Cloud Vision API for highly accurate word detection (99%+ accuracy).
                    </p>
                    <div class="setup-steps">
                        <h3>Quick Setup (2 minutes):</h3>
                        <ol>
                            <li>Go to <a href="https://console.cloud.google.com/apis/credentials" target="_blank">Google Cloud Console</a></li>
                            <li>Create a new API key</li>
                            <li>Enable "Cloud Vision API" (for text recognition)</li>
                            <li>Enable "Cloud Speech-to-Text API" (for audio analysis)</li>
                            <li>Paste your API key below</li>
                        </ol>
                        <p class="note">Free tier: 1,000 Vision requests + 60 minutes Speech/month</p>
                    </div>
                    <div class="api-key-input">
                        <input type="password" id="api-key" placeholder="Enter your Google Cloud Vision API key" />
                        <button id="save-api-key-btn" class="btn btn-primary">Save & Start</button>
                    </div>
                    <p class="privacy-note">Your API key is stored locally in your browser only.</p>
                </div>
            </section>

            <!-- Camera Section -->
            <section id="camera-section" class="section">
                <div class="camera-container">
                    <video id="camera" autoplay playsinline></video>
                    <canvas id="camera-canvas" style="display: none;"></canvas>
                </div>
                <div class="controls">
                    <button id="capture-btn" class="btn btn-primary">
                        <span class="icon">üì∑</span> Capture Photo
                    </button>
                    <button id="upload-btn-camera" class="btn btn-secondary">
                        <span class="icon">üìÅ</span> Upload Photo
                    </button>
                </div>
                <div class="controls">
                    <button id="record-audio-btn" class="btn btn-audio">
                        <span class="icon">üé§</span> Record Audio
                    </button>
                </div>

                <div class="instructions-box">
                    <h4>üìã How to Analyze Pronunciation:</h4>
                    <ol class="instructions-list">
                        <li>Record audio of someone reading</li>
                        <li>Capture an image of the text</li>
                        <li>Highlight the text they read</li>
                        <li>Click "Analyze Audio" for pronunciation feedback</li>
                    </ol>
                </div>

                <input type="file" id="file-input-camera" accept="image/*" style="display: none;">
            </section>

            <!-- Image Processing Section -->
            <section id="image-section" class="section">
                <div class="image-wrapper">
                    <div class="image-container">
                        <canvas id="selection-canvas"></canvas>
                    </div>
                    <div class="zoom-controls">
                        <button id="zoom-in-btn" class="zoom-btn" title="Zoom In">+</button>
                        <button id="zoom-out-btn" class="zoom-btn" title="Zoom Out">‚àí</button>
                        <button id="zoom-reset-btn" class="zoom-btn" title="Reset View">‚ü≤</button>
                    </div>
                </div>

                <div class="controls">
                    <button id="record-audio-btn-image" class="btn btn-audio">
                        <span class="icon">üé§</span> Record Audio
                    </button>
                </div>
                <div class="controls">
                    <button id="retake-btn" class="btn btn-secondary">
                        <span class="icon">üîÑ</span> Retake Photo
                    </button>
                    <button id="upload-btn-image" class="btn btn-secondary">
                        <span class="icon">üìÅ</span> Upload Photo
                    </button>
                </div>
                <div class="controls">
                    <button id="reset-selection-btn" class="btn btn-secondary">
                        <span class="icon">‚úñÔ∏è</span> Clear Selection
                    </button>
                </div>
                <input type="file" id="file-input-image" accept="image/*" style="display: none;">
                <div id="status" class="status"></div>
                <div class="export-section">
                    <button id="export-btn" class="btn btn-export">
                        <span class="icon">üìã</span> Export Selected Words
                    </button>
                    <div id="export-output" class="export-output"></div>
                </div>
            </section>
        </main>

        <footer>
            <p class="hint">üëÜ Left-click: drag to select words ‚Ä¢ Right-click: drag to pan image ‚Ä¢ Click yellow words to deselect</p>
            <p class="version">Version: 2025-01-21 17:45 UTC</p>
        </footer>
    </div>

    <!-- Audio Recording Modal -->
    <div id="audio-modal" class="modal">
        <div class="modal-content">
            <h2>Record Audio</h2>
            <p>How many minutes would you like to record?</p>
            <div class="duration-input">
                <input type="number" id="audio-duration" min="1" max="5" value="1" />
                <span>minutes (max 5)</span>
            </div>
            <div class="modal-buttons">
                <button id="start-recording-btn" class="btn btn-primary">Start Recording</button>
                <button id="cancel-recording-btn" class="btn btn-secondary">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Recording Status Modal -->
    <div id="recording-modal" class="modal">
        <div class="modal-content recording-active">
            <h2>üé§ Recording...</h2>
            <div class="recording-timer" id="recording-timer">00:00</div>
            <div class="recording-progress">
                <div class="progress-bar" id="progress-bar"></div>
            </div>
            <button id="stop-recording-btn" class="btn btn-danger">Stop Recording</button>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="app.js"></script>
</body>
</html>
